<!doctype html><html lang=en dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Basic Math for Two Photon Fluorescence Microscopy | Vision Tech Insights</title>
<meta name=keywords content="modeling,imaging system,optics"><meta name=description content="Basic mathematical modeling method for imaging systems, using two photon fluorescence microscopy as an example."><meta name=author content="Jian Zhong"><link rel=canonical href=http://localhost:1313/posts/basic_math_for_two_photon_fluorescence_microscopy/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.5ff2630c4d1b3e25bc21f0ecd96681dbcf58219e741fa627857820b5485cb770.css integrity="sha256-X/JjDE0bPiW8IfDs2WaB289YIZ50H6YnhXggtUhct3A=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=http://localhost:1313/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=http://localhost:1313/posts/basic_math_for_two_photon_fluorescence_microscopy/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css integrity=sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js integrity=sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4 crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js integrity=sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-123-45","auto"),ga("send","pageview"))</script><meta property="og:title" content="Basic Math for Two Photon Fluorescence Microscopy"><meta property="og:description" content="Basic mathematical modeling method for imaging systems, using two photon fluorescence microscopy as an example."><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/basic_math_for_two_photon_fluorescence_microscopy/"><meta property="og:image" content="http://localhost:1313/images/basic_math_for_two_photon_fluorescence_microscopy/2PFM_Principles.png"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-04-16T00:00:00+00:00"><meta property="article:modified_time" content="2024-04-16T00:00:00+00:00"><meta property="og:site_name" content="ExampleSite"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://localhost:1313/images/basic_math_for_two_photon_fluorescence_microscopy/2PFM_Principles.png"><meta name=twitter:title content="Basic Math for Two Photon Fluorescence Microscopy"><meta name=twitter:description content="Basic mathematical modeling method for imaging systems, using two photon fluorescence microscopy as an example."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"http://localhost:1313/posts/"},{"@type":"ListItem","position":2,"name":"Basic Math for Two Photon Fluorescence Microscopy","item":"http://localhost:1313/posts/basic_math_for_two_photon_fluorescence_microscopy/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Basic Math for Two Photon Fluorescence Microscopy","name":"Basic Math for Two Photon Fluorescence Microscopy","description":"Basic mathematical modeling method for imaging systems, using two photon fluorescence microscopy as an example.","keywords":["modeling","imaging system","optics"],"articleBody":"It’s really helpful to do some basic math to understand how well an imaging system works when you’re designing or improving it. Most of the time, a very basic model of the system can provide a ton of useful information. Therefore, I would like to share an example of how we can crunch some numbers to understand the signal and noise in a two-photon fluorescence microscope (2PFM). In the end, I will also provide a practical demo of how this math can help us make the system work better.\nIntroduction to Two-Photon Microscopy As shown in the cover image of this post, two-photon fluorescence microscopes work by scanning laser beams across a sample and capturing the fluorescent light emitted at each spot. Typically, they use scanning mirrors like galvo mirrors to move the laser beams around. At each scan location, laser beam reflected by the scanning mirrors is relayed to the objective lens using a tube lens and a scan lens. The objective lens then focuses the laser beam into the sample. Afterward, the fluorescence emitted from the sample is gathered by the same objective lens, redirected by a dichroic mirror (which transmits the excitation light while reflects the fluorescence), and finally gathered by some collection optics before being detected by a photodetector (usually a photomultiplier tube (PMT)).\nTwo photon fluorescence microscopes utilize two-photon excitation phenomenon to make fluorophores in samples light up. This happens when the molecules absorb two photons of light at the same time. Because of its low possibility, two photon excitation only occurs in the focal point inside the sample, where the laser beam is most intense (the density of the excitation photons reaches a maximum). To increase the efficiency of two photon excitation and avoid damaging the sample, two photon microscopes send laser pulses with very short pulse width (~femtosecond) into the sample, instead of using a high power continuous-wave laser .\nModeling of the Imaging System summary of the imaging system modeling (image credit: Jian Zhong)\nAt the heart of the two-photon microscope is the two-photon excitation phenomenon. So, when we model these microscopes, we’ll follow the sequence of this process: excitation, two-photon absorption, fluorescence generation, and finally fluorescence signal detection. Since each scan location behaves the same way, we’ll zoom in on just one spot for our analysis. We’ll start by looking at how fluorescence is generated with a single pulse and a single fluorophore, and then we’ll generalize our analysis to include multiple laser pulses and all the fluorophores within the focal point.\nTo keep our analysis focused on the most crucial factors, I've used \"\\(\\backsimeq\\)\" notation to show when things are equal by a constant factor, where the constant factor does not depend on the variable explicitly listed on the right-hand-side of the equation. So where wherever we see equation like \\( z \\backsimeq x \\cdot y \\), it means \\( z = const \\cdot (x \\cdot y) \\), where the constant \\(const\\) doesn’t depend on \\(x\\) and \\(y\\). Excitation Process Firstly, let’s model the input laser pulses incident to the sample. For most of the two photon systems we can find out the following details about the laser pulses.\nAverage power ( \\(P_{avg}\\) ): We can measure this by putting a power meter after the objective lens.\nRepetition rate ( \\(f_{PulseRR}\\) ): The laser specs usually tell us this, or we can measure it with an oscilloscope and a fast photo-diode.\nExcitation wavelength ( \\(\\lambda_{ext}\\) ): This is also in the laser specs, or we can measure it with a spectrometer.\nPulse width ( \\(\\tau_{PW}\\) ): We can measure this with an auto-correlator, or estimate it using the laser specs and the dispersion specs of the optics in the system.\nLaser pulses can have different shapes over time, but for our initial estimation, a simple rectangular shape is usually good enough. So, that’s what we’ll use in our analysis.\nWith these information, we can first calculate the instantaneous energy within a single laser pulse ( \\(E_{Pulse}\\) ) as follows:\n$$ E_{Pulse} = \\frac{P_{avg}}{f_{PulseRR}} $$\n( The trick to understand this formula is not difficult: the total energy during a certain duration \\(\\Delta t\\) is \\(P_{avg} \\cdot \\Delta t\\), and the number of pulses during this dulation is \\(f_{PulseRR} \\cdot \\Delta t\\) so the enery inside each pulse is simply the total energy divided by the number of pulses \\(E_{Pulse} = \\frac{P_{avg} \\cdot \\Delta t}{f_{PulseRR} \\cdot \\Delta t} = \\frac{P_{avg}}{f_{PulseRR}} \\) )\nConsidering that we modeled the laser pulse as a rectangular temporal profile, the instantaneous laser power within the duration of the laser pulse ( \\(P_{ins}\\) ) is as follows:\n$$ P_{ins} = \\frac{E_{Pulse}}{\\tau_{PW}} $$\nFurther analysis of the excitation process requires the knowledge of the excitation focus volume ( \\(V_{focus}\\) ). We can figure this out by measuring the Point Spread Function (PSF). Or, we can estimate it by modeling the excitation focus volume as a cylinder with a certain base area ( \\(A_{focus}\\) ) and height ( \\(d_{focus}\\) ), where the base area and height can be estimated using the lateral and axial resolution of the system respectively.\nFor conventional two photon microscopes, the lateral resolution ( \\(Res_{Lateral}\\) ) is given by:\n$$ Res_{Lateral} = 0.51 \\frac{\\lambda_{ext}}{\\sqrt{2} \\cdot NA} $$\nwhile the axial resolution ( \\(Res_{Axial}\\) ) is given by:\n$$ Res_{Axial} = 0.88 \\frac{\\lambda_{ext}}{\\sqrt{2} (\\ n - \\sqrt{n^2 - NA^2} )} $$\nWhere the \\(NA\\) is the numberical aperture of focused laser beam, \\(n\\) is the refractive index of the immesion medium.\nTypically, laser beam entering the objective lens fills its backpupil, so the \\(NA\\) of the focused laser beam is the same as the \\(NA\\) of the objective lens.\nFor water immersion objetive lenses, \\(n\\) is the refractive index of water ( \\(n = 1.33\\) ). For dry objective lenses, \\(n\\) is the refractive index of air ( \\(n = 1\\) ).\nWith the lateral and axial resolution of the two-photon microscope, the base area ( \\(A_{focus}\\) ) and height ( \\(d_{focus}\\) ) of the focus volume can be extimated as:\n$$ d_{focus} \\backsimeq Res_{Axial} $$\n$$ A_{focus} \\backsimeq \\pi \\cdot ( \\frac{Res_{Lateral}}{2} )^2 $$\nWith our simplied cylinder model for focus volume, focus volume ( \\(V_{focus}\\) ) can be calcualted as:\n$$ V_{focus} \\backsimeq A_{focus} \\cdot d_{focus} \\backsimeq \\pi \\cdot ( \\frac{Res_{Lateral}}{2} )^2 \\cdot Res_{Axial} $$\nThen, the instantaneous intensity of the excitation light during the duration of the laser pulse is as follows:\n$$ I_{ins} \\backsimeq \\frac{P_{ins}}{A_{focus}} = \\frac{E_{Pulse}}{A_{focus} \\cdot \\tau_{PW}} = \\frac{P_{avg}}{f_{PulseRR} \\cdot A_{focus} \\cdot \\tau_{PW}} $$\nTwo Photon Absorption and Fluorescence Generation Next, we’ll delve into modeling the two-photon absorption and fluorescence generation within the excitation volume. Typically, this volume contains numerous fluorophores. Initially, we’ll concentrate on describing how a single fluorophore interacts with a single laser pulse, then extend our findings to encompass all the fluorophore within the entire excitation volume interacting with a single laser pulse.\nDuring the two-photon absorption process, a fluorophore in its ground state absorbs two excitation photons and transitions to an excited state with a certain probability. This process is probabilistic, and its efficiency can be quantified using the two-photon transition rate ( \\(\\omega_{Transition}\\) ). This rate essentially tells us how many two-photon absorption events occur per unit time. In quantum mechanics, the two-photon transition rate is defined as follows:\n$$ \\omega_{Transition} = \\sigma_{2PCross} \\cdot ( I_{ins} )^2 \\backsimeq \\sigma_{2PCross} \\cdot (\\frac{P_{avg}}{f_{PulseRR} \\cdot A_{focus} \\cdot \\tau_{PW}})^2 $$\nHere, \\(\\sigma_{2PCross}\\) is the cross section of two photon absorption, which depends on the properties of the fluorophore.\nTwo photon absorption will only happen during the duration of the laser pulse, (during which the fluorophore encounters the excitation photons). With the transition rate, the following formula shows how many times this happens to one molecule during the entire laser pulse.\n$$ N_{Absorp} = \\omega_{Transition} \\cdot \\tau_{PW} $$ $$ \\backsimeq \\sigma_{2PCross} \\cdot (\\frac{P_{avg}}{f_{PulseRR} \\cdot A_{focus} \\cdot \\tau_{PW}})^2 \\cdot \\tau_{PW} $$ $$ = \\sigma_{2PCross} \\cdot P_{avg}^2 ( \\frac{1}{f_{PulseRR}} )^2 ( \\frac{1}{A_{focus}} )^2 \\frac{1}{\\tau_{PW}} $$\nOnce the fluorophore gets excited, it eventually returns to its original state and releases a fluorescence photon. This process happens with a certain probability. We use \\(\\eta_{Q}\\) to represent how efficiently this transition occurs from the excited state to emitting a fluorescence photon. It’s basically the conversion rate from absorbing two photons to emitting one fluorescence photon. The formula below tells us how many photons a single fluorophore emits during one laser pulse of excitation ( \\(N_{FP}\\) ).\n$$ N_{FP} = \\eta_{Q} \\cdot N_{Absorp} $$\n$$ \\backsimeq \\eta_{Q} \\cdot \\sigma_{2PCross} \\cdot P_{avg}^2 ( \\frac{1}{f_{PulseRR}} )^2 ( \\frac{1}{A_{focus}} )^2 \\frac{1}{\\tau_{PW}} $$\nNow, we finished the analysis of a single fluorophore interacting with a single laser pulse. Usually, the excitation volume contains more than one fluorophore. If we denote the density of the fluorophores as \\(\\rho_{fluor}\\) , then the total number of fluorophores within the excitation volume ( \\(N_{fluor}\\) ) can be expressed as:\n$$ N_{fluor} = \\rho_{fluor} \\cdot V_{focus} $$\nUsing the cylindrical model to represent the focused excitation volume, we can express the total number of fluorophores within that volume as follows:\n$$ N_{fluor} = \\rho_{fluor} \\cdot V_{focus} \\backsimeq \\rho_{fluor} \\cdot A_{focus} \\cdot d_{focus} $$\nAfter a single laser pulse hits the sample, the total number of fluorescence photons emitted from the focus volume ( \\(N_{totFP}\\) ) is just the result of multiplying the total number of fluorophores (within the focus volume) by the number of fluorescence photons emitted by each fluorophore.\n$$ N_{totFP} = N_{fluor} \\cdot N_{FP} $$ $$ \\backsimeq ( \\rho_{fluor} \\cdot A_{focus} \\cdot d_{focus} ) \\cdot ( \\eta_{Q} \\cdot \\sigma_{2PCross} \\cdot P_{avg}^2 ( \\frac{1}{f_{PulseRR}} )^2 ( \\frac{1}{A_{focus}} )^2 \\frac{1}{\\tau_{PW}} ) $$ $$ = \\rho_{fluor} \\cdot \\eta_{Q} \\cdot \\sigma_{2PCross} \\cdot P_{avg}^2 ( \\frac{1}{f_{PulseRR}} )^2 ( \\frac{1}{\\tau_{PW}} ) ( \\frac{1}{A_{focus}} ) \\cdot d_{focus} $$\nFluorescence Signal Detection The fluorescence photons will be collected by the objective lens, travel through the detection light path, and be detected by the photon detector. The photon detector converts them into a specific type of signal, usually electrical, which is easy to record and save. While the process of collecting them can be complex, we can simplify it by describing the efficiency of converting fluorescence photons to signals using a factor ( \\(\\eta_{collect}\\) ). This factor encompasses various elements like the numerical aperture of the objective lens, the transmission of the detection optics, and the conversion efficiency of the detectors. The signal is usually measured by the number of photons recorded, which we’ll call “signal photons” here. So, the total count of signal photons ( \\(N_{Signal}\\) ) generated by one laser pulse can be expressed as:\n$$ N_{Signal} = \\eta_{collect} \\cdot N_{totFP} $$\n$$ \\backsimeq \\eta_{collect} \\cdot \\rho_{fluor} \\cdot \\eta_{Q} \\cdot \\sigma_{2PCross} \\cdot P_{avg}^2 ( \\frac{1}{f_{PulseRR}} )^2 ( \\frac{1}{\\tau_{PW}} ) ( \\frac{1}{A_{focus}} ) \\cdot d_{focus} $$\nIntegration of Multiple Pulses and Signal-to-Noise Ratio Typically, in two-photon microscopes, the microscope stays at each pixel spot (or, scan location) for a specific amount of time (which is usually called dwell time). During this time, multiple laser pulses hit the sample, and all the fluorescence generated by these pulses are collected. So, the overall signal for each pixel spot (or, scan location) can be calculated like this:\n$$ N_{totSignal} = N_{pulse} \\cdot N_{Signal} $$ $$ \\backsimeq N_{pulse} \\cdot \\eta_{collect} \\cdot \\rho_{fluor} \\cdot \\eta_{Q} \\cdot \\sigma_{2PCross} \\cdot P_{avg}^2 ( \\frac{1}{f_{PulseRR}} )^2 ( \\frac{1}{\\tau_{PW}} ) ( \\frac{1}{A_{focus}} ) \\cdot d_{focus} $$\nWhere \\(N_{Pulse}\\) is the number of laser pulses that hit the sample at each scan location.\nThe distribution of signal photons usually follows a Poisson distribution. If we suppose that all other sources of noise in the system, like electrical noise, ambient light leaking in, or fluctuations in the laser pulse energy, are negligible, the signal to noise ratio (SNR) of each scan location can be written as:\n$$ SNR = \\sqrt{N_{totSignal}} $$\nSide Notes Usually, the specific characteristics of the fluorophores ( \\(\\rho_{fluor}\\) , \\(\\eta_{Q}\\) , and \\(\\sigma_{2PCross}\\) ) are difficult to be quantified. However, we can compare the signals from two fluorophores under the same conditions. By doing this, we can determine how much brighter one fluorophore is compared to another. Taking in the formula we derived above, for fluorophores A and B, if we image them with the same two photon microscope and exactly the same condition, we can have the following comparison result:\n$$ \\frac{ \\rho_{fluor_A} \\cdot \\eta_{Q_A} \\cdot \\sigma_{2PCross_A} }{ \\rho_{fluor_B} \\cdot \\eta_{Q_B} \\cdot \\sigma_{2PCross_B} } = \\frac{N_{totSignal_A}}{N_{totSignal_B}} $$\nExample Application As a practice, let’s explore how to double the signal-to-noise ratio (SNR) of a two photon microscope.\nTo improve the signal-to-noise ratio (SNR) of a two-photon imaging system by two times, we need to boost the signal by four times, according to the formula mentioned earlier. Here are some potential strategies we can consider:\nIncrease dwell time at each pixel by four times. This means letting the microscope linger longer at each pixel to gather more signal from the incident pulses. However, this might slow down the overall imaging process or reduce the number of pixels in the image, which could affect certain applications.\nCompress the pulse duration by four times. Adding a module for pulse compression or dispersion compensation optics in the system can achieve this. It helps in packing more energy into each pulse, potentially enhancing the signal.\nDouble the average power. While increasing power can boost signal strength, it must be done cautiously to avoid damaging the sample.\nEnhance detection efficiency by four times. This involves optimizing both the optical and electronic designs of the detection system to capture more of the fluorescence signal.\nThese methods aren’t mutually exclusive; we can combine several approaches to achieve the desired increase in SNR. However, it’s crucial to carefully evaluate the impact of each strategy on the overall system performance and the specific requirements of the application at hand.\nConclusion Understanding the imaging system in numbers is key for its design and optimization. The simplest math models and assumptions are a good start for our analysis, and usually reveal a lot about the system. Also, keep in mind the assumptions and simplifications we made during modeling. This way, we can easily come back to validate and refine your model later if needed.\nCitation If you found this article helpful, please cite it as:\nZhong, Jian (Apr 2024). Basic Math for Two Photon Fluorescence Microscopy. Vision Tech Insights. https://jianzhongdev.github.io/VisionTechInsights/posts/basic_math_for_two_photon_fluorescence_microscopy/.\nOr\n@article{zhong2024basicmath2PFM, title = \"Basic Math for Two Photon Fluorescence Microscopy\", author = \"Zhong, Jian\", journal = \"jianzhongdev.github.io\", year = \"2024\", month = \"Apr\", url = \"https://jianzhongdev.github.io/VisionTechInsights/posts/basic_math_for_two_photon_fluorescence_microscopy/\" } ","wordCount":"2407","inLanguage":"en","image":"http://localhost:1313/images/basic_math_for_two_photon_fluorescence_microscopy/2PFM_Principles.png","datePublished":"2024-04-16T00:00:00Z","dateModified":"2024-04-16T00:00:00Z","author":{"@type":"Person","name":"Jian Zhong"},"mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/basic_math_for_two_photon_fluorescence_microscopy/"},"publisher":{"@type":"Organization","name":"Vision Tech Insights","logo":{"@type":"ImageObject","url":"http://localhost:1313/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="Vision Tech Insights (Alt + H)"><img src=http://localhost:1313/apple-touch-icon.png alt aria-label=logo height=35>Vision Tech Insights</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/posts/ title=Posts><span>Posts</span></a></li><li><a href=http://localhost:1313/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://localhost:1313/projects/ title=Projects><span>Projects</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=http://localhost:1313/>Home</a>&nbsp;»&nbsp;<a href=http://localhost:1313/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Basic Math for Two Photon Fluorescence Microscopy</h1><div class=post-description>Basic mathematical modeling method for imaging systems, using two photon fluorescence microscopy as an example.</div><div class=post-meta><span title='2024-04-16 00:00:00 +0000 UTC'>April 16, 2024</span>&nbsp;·&nbsp;12 min&nbsp;·&nbsp;2407 words&nbsp;·&nbsp;Jian Zhong</div></header><figure class=entry-cover><img loading=eager srcset="http://localhost:1313/images/basic_math_for_two_photon_fluorescence_microscopy/2PFM_Principles_hu56cec669adbdee3a87b260d628634efd_518952_360x0_resize_box_3.png 360w ,http://localhost:1313/images/basic_math_for_two_photon_fluorescence_microscopy/2PFM_Principles_hu56cec669adbdee3a87b260d628634efd_518952_480x0_resize_box_3.png 480w ,http://localhost:1313/images/basic_math_for_two_photon_fluorescence_microscopy/2PFM_Principles_hu56cec669adbdee3a87b260d628634efd_518952_720x0_resize_box_3.png 720w ,http://localhost:1313/images/basic_math_for_two_photon_fluorescence_microscopy/2PFM_Principles_hu56cec669adbdee3a87b260d628634efd_518952_1080x0_resize_box_3.png 1080w ,http://localhost:1313/images/basic_math_for_two_photon_fluorescence_microscopy/2PFM_Principles_hu56cec669adbdee3a87b260d628634efd_518952_1500x0_resize_box_3.png 1500w ,http://localhost:1313/images/basic_math_for_two_photon_fluorescence_microscopy/2PFM_Principles.png 3510w" sizes="(min-width: 768px) 720px, 100vw" src=http://localhost:1313/images/basic_math_for_two_photon_fluorescence_microscopy/2PFM_Principles.png alt="[cover image] principles of two photon fluorescence microscopy (image credit: Jian Zhong)" width=3510 height=2478><p>[cover image] principles of two photon fluorescence microscopy (image credit: Jian Zhong)</p></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#introduction-to-two-photon-microscopy>Introduction to Two-Photon Microscopy</a></li><li><a href=#modeling-of-the-imaging-system>Modeling of the Imaging System</a><ul><li><a href=#excitation-process>Excitation Process</a></li><li><a href=#two-photon-absorption-and-fluorescence-generation>Two Photon Absorption and Fluorescence Generation</a></li><li><a href=#fluorescence-signal-detection>Fluorescence Signal Detection</a></li><li><a href=#integration-of-multiple-pulses-and-signal-to-noise-ratio>Integration of Multiple Pulses and Signal-to-Noise Ratio</a></li><li><a href=#side-notes>Side Notes</a></li></ul></li><li><a href=#example-application>Example Application</a></li><li><a href=#conclusion>Conclusion</a></li><li><a href=#citation>Citation</a></li></ul></nav></div></details></div><div class=post-content><p>It&rsquo;s really helpful to do some basic math to understand how well an imaging system works when you&rsquo;re designing or improving it. Most of the time, a very basic model of the system can provide a ton of useful information. Therefore, I would like to share an example of how we can crunch some numbers to understand the signal and noise in a two-photon fluorescence microscope (2PFM). In the end, I will also provide a practical demo of how this math can help us make the system work better.</p><h2 id=introduction-to-two-photon-microscopy>Introduction to Two-Photon Microscopy<a hidden class=anchor aria-hidden=true href=#introduction-to-two-photon-microscopy>#</a></h2><p>As shown in the <strong>cover image</strong> of this post, two-photon fluorescence microscopes work by scanning laser beams across a sample and capturing the fluorescent light emitted at each spot. Typically, they use scanning mirrors like galvo mirrors to move the laser beams around. At each scan location, laser beam reflected by the scanning mirrors is relayed to the objective lens using a tube lens and a scan lens. The objective lens then focuses the laser beam into the sample. Afterward, the fluorescence emitted from the sample is gathered by the same objective lens, redirected by a dichroic mirror (which transmits the excitation light while reflects the fluorescence), and finally gathered by some collection optics before being detected by a photodetector (usually a photomultiplier tube (PMT)).</p><p>Two photon fluorescence microscopes utilize two-photon excitation phenomenon to make fluorophores in samples light up. This happens when the molecules absorb two photons of light at the same time. Because of its low possibility, two photon excitation only occurs in the focal point inside the sample, where the laser beam is most intense (the density of the excitation photons reaches a maximum). To increase the efficiency of two photon excitation and avoid damaging the sample, two photon microscopes send laser pulses with very short pulse width (~femtosecond) into the sample, instead of using a high power continuous-wave laser .</p><h2 id=modeling-of-the-imaging-system>Modeling of the Imaging System<a hidden class=anchor aria-hidden=true href=#modeling-of-the-imaging-system>#</a></h2><figure class=align-center><img loading=lazy src=./2PFM_ModelingSummary.png#center><figcaption><p>summary of the imaging system modeling (image credit: Jian Zhong)</p></figcaption></figure><p>At the heart of the two-photon microscope is the two-photon excitation phenomenon. So, when we model these microscopes, we&rsquo;ll follow the sequence of this process: excitation, two-photon absorption, fluorescence generation, and finally fluorescence signal detection. Since each scan location behaves the same way, we&rsquo;ll zoom in on just one spot for our analysis. We&rsquo;ll start by looking at how fluorescence is generated with a single pulse and a single fluorophore, and then we&rsquo;ll generalize our analysis to include multiple laser pulses and all the fluorophores within the focal point.</p><p>To keep our analysis focused on the most crucial factors, I've used "\(\backsimeq\)" notation to show when things are equal by a constant factor, where the constant factor does not depend on the variable explicitly listed on the right-hand-side of the equation. So where wherever we see equation like \( z \backsimeq x \cdot y \), it means \( z = const \cdot (x \cdot y) \), where the constant \(const\) doesn’t depend on \(x\) and \(y\).</p><h3 id=excitation-process>Excitation Process<a hidden class=anchor aria-hidden=true href=#excitation-process>#</a></h3><p>Firstly, let’s model the input laser pulses incident to the sample. For most of the two photon systems we can find out the following details about the laser pulses.</p><ul><li><p>Average power ( \(P_{avg}\) ): We can measure this by putting a power meter after the objective lens.</p></li><li><p>Repetition rate ( \(f_{PulseRR}\) ): The laser specs usually tell us this, or we can measure it with an oscilloscope and a fast photo-diode.</p></li><li><p>Excitation wavelength ( \(\lambda_{ext}\) ): This is also in the laser specs, or we can measure it with a spectrometer.</p></li><li><p>Pulse width ( \(\tau_{PW}\) ): We can measure this with an auto-correlator, or estimate it using the laser specs and the dispersion specs of the optics in the system.</p></li></ul><p>Laser pulses can have different shapes over time, but for our initial estimation, a simple rectangular shape is usually good enough. So, that&rsquo;s what we&rsquo;ll use in our analysis.</p><p>With these information, we can first calculate the instantaneous energy within a single laser pulse ( \(E_{Pulse}\) ) as follows:</p><p>$$
E_{Pulse} = \frac{P_{avg}}{f_{PulseRR}}
$$</p><p>(<em>
The trick to understand this formula is not difficult: the total energy during a certain duration \(\Delta t\) is \(P_{avg} \cdot \Delta t\), and the number of pulses during this dulation is \(f_{PulseRR} \cdot \Delta t\) so the enery inside each pulse is simply the total energy divided by the number of pulses \(E_{Pulse} = \frac{P_{avg} \cdot \Delta t}{f_{PulseRR} \cdot \Delta t} = \frac{P_{avg}}{f_{PulseRR}} \)
</em>)</p><p>Considering that we modeled the laser pulse as a rectangular temporal profile, the instantaneous laser power within the duration of the laser pulse ( \(P_{ins}\) ) is as follows:</p><p>$$
P_{ins} = \frac{E_{Pulse}}{\tau_{PW}}
$$</p><p>Further analysis of the excitation process requires the knowledge of the excitation focus volume ( \(V_{focus}\) ). We can figure this out by measuring the Point Spread Function (PSF). Or, we can estimate it by modeling the excitation focus volume as a cylinder with a certain base area ( \(A_{focus}\) ) and height ( \(d_{focus}\) ), where the base area and height can be estimated using the lateral and axial resolution of the system respectively.</p><p>For conventional two photon microscopes, the lateral resolution ( \(Res_{Lateral}\) ) is given by:</p><p>$$
Res_{Lateral} = 0.51 \frac{\lambda_{ext}}{\sqrt{2} \cdot NA}
$$</p><p>while the axial resolution ( \(Res_{Axial}\) ) is given by:</p><p>$$
Res_{Axial} = 0.88 \frac{\lambda_{ext}}{\sqrt{2} (\ n - \sqrt{n^2 - NA^2} )}
$$</p><p>Where the \(NA\) is the numberical aperture of focused laser beam, \(n\) is the refractive index of the immesion medium.</p><p>Typically, laser beam entering the objective lens fills its backpupil, so the \(NA\) of the focused laser beam is the same as the \(NA\) of the objective lens.</p><p>For water immersion objetive lenses, \(n\) is the refractive index of water ( \(n = 1.33\) ). For dry objective lenses, \(n\) is the refractive index of air ( \(n = 1\) ).</p><p>With the lateral and axial resolution of the two-photon microscope, the base area ( \(A_{focus}\) ) and height ( \(d_{focus}\) ) of the focus volume can be extimated as:</p><p>$$
d_{focus} \backsimeq Res_{Axial}
$$</p><p>$$
A_{focus} \backsimeq \pi \cdot ( \frac{Res_{Lateral}}{2} )^2
$$</p><p>With our simplied cylinder model for focus volume, focus volume ( \(V_{focus}\) ) can be calcualted as:</p><p>$$
V_{focus} \backsimeq A_{focus} \cdot d_{focus} \backsimeq \pi \cdot ( \frac{Res_{Lateral}}{2} )^2 \cdot Res_{Axial}
$$</p><p>Then, the instantaneous intensity of the excitation light during the duration of the laser pulse is as follows:</p><p>$$
I_{ins} \backsimeq \frac{P_{ins}}{A_{focus}} = \frac{E_{Pulse}}{A_{focus} \cdot \tau_{PW}} = \frac{P_{avg}}{f_{PulseRR} \cdot A_{focus} \cdot \tau_{PW}}
$$</p><h3 id=two-photon-absorption-and-fluorescence-generation>Two Photon Absorption and Fluorescence Generation<a hidden class=anchor aria-hidden=true href=#two-photon-absorption-and-fluorescence-generation>#</a></h3><p>Next, we&rsquo;ll delve into modeling the two-photon absorption and fluorescence generation within the excitation volume. Typically, this volume contains numerous fluorophores. Initially, we&rsquo;ll concentrate on describing how a single fluorophore interacts with a single laser pulse, then extend our findings to encompass all the fluorophore within the entire excitation volume interacting with a single laser pulse.</p><p>During the two-photon absorption process, a fluorophore in its ground state absorbs two excitation photons and transitions to an excited state with a certain probability. This process is probabilistic, and its efficiency can be quantified using the two-photon transition rate ( \(\omega_{Transition}\) ). This rate essentially tells us how many two-photon absorption events occur per unit time. In quantum mechanics, the two-photon transition rate is defined as follows:</p><p>$$
\omega_{Transition} = \sigma_{2PCross} \cdot ( I_{ins} )^2 \backsimeq \sigma_{2PCross} \cdot (\frac{P_{avg}}{f_{PulseRR} \cdot A_{focus} \cdot \tau_{PW}})^2
$$</p><p>Here, \(\sigma_{2PCross}\) is the cross section of two photon absorption, which depends on the properties of the fluorophore.</p><p>Two photon absorption will only happen during the duration of the laser pulse, (during which the fluorophore encounters the excitation photons). With the transition rate, the following formula shows how many times this happens to one molecule during the entire laser pulse.</p><p>$$
N_{Absorp} = \omega_{Transition} \cdot \tau_{PW}
$$
$$
\backsimeq \sigma_{2PCross} \cdot (\frac{P_{avg}}{f_{PulseRR} \cdot A_{focus} \cdot \tau_{PW}})^2 \cdot \tau_{PW}
$$
$$
= \sigma_{2PCross} \cdot P_{avg}^2 ( \frac{1}{f_{PulseRR}} )^2 ( \frac{1}{A_{focus}} )^2 \frac{1}{\tau_{PW}}
$$</p><p>Once the fluorophore gets excited, it eventually returns to its original state and releases a fluorescence photon. This process happens with a certain probability. We use \(\eta_{Q}\) to represent how efficiently this transition occurs from the excited state to emitting a fluorescence photon. It&rsquo;s basically the conversion rate from absorbing two photons to emitting one fluorescence photon. The formula below tells us how many photons a single fluorophore emits during one laser pulse of excitation ( \(N_{FP}\) ).</p><p>$$
N_{FP} = \eta_{Q} \cdot N_{Absorp}
$$</p><p>$$
\backsimeq \eta_{Q} \cdot \sigma_{2PCross} \cdot P_{avg}^2 ( \frac{1}{f_{PulseRR}} )^2 ( \frac{1}{A_{focus}} )^2 \frac{1}{\tau_{PW}}
$$</p><p>Now, we finished the analysis of a single fluorophore interacting with a single laser pulse. Usually, the excitation volume contains more than one fluorophore. If we denote the density of the fluorophores as \(\rho_{fluor}\) , then the total number of fluorophores within the excitation volume ( \(N_{fluor}\) ) can be expressed as:</p><p>$$
N_{fluor} = \rho_{fluor} \cdot V_{focus}
$$</p><p>Using the cylindrical model to represent the focused excitation volume, we can express the total number of fluorophores within that volume as follows:</p><p>$$
N_{fluor} = \rho_{fluor} \cdot V_{focus} \backsimeq \rho_{fluor} \cdot A_{focus} \cdot d_{focus}
$$</p><p>After a single laser pulse hits the sample, the total number of fluorescence photons emitted from the focus volume ( \(N_{totFP}\) ) is just the result of multiplying the total number of fluorophores (within the focus volume) by the number of fluorescence photons emitted by each fluorophore.</p><p>$$
N_{totFP} = N_{fluor} \cdot N_{FP}
$$
$$
\backsimeq ( \rho_{fluor} \cdot A_{focus} \cdot d_{focus} ) \cdot ( \eta_{Q} \cdot \sigma_{2PCross} \cdot P_{avg}^2 ( \frac{1}{f_{PulseRR}} )^2 ( \frac{1}{A_{focus}} )^2 \frac{1}{\tau_{PW}} )
$$
$$
= \rho_{fluor} \cdot \eta_{Q} \cdot \sigma_{2PCross} \cdot P_{avg}^2 ( \frac{1}{f_{PulseRR}} )^2 ( \frac{1}{\tau_{PW}} ) ( \frac{1}{A_{focus}} ) \cdot d_{focus}
$$</p><h3 id=fluorescence-signal-detection>Fluorescence Signal Detection<a hidden class=anchor aria-hidden=true href=#fluorescence-signal-detection>#</a></h3><p>The fluorescence photons will be collected by the objective lens, travel through the detection light path, and be detected by the photon detector. The photon detector converts them into a specific type of signal, usually electrical, which is easy to record and save. While the process of collecting them can be complex, we can simplify it by describing the efficiency of converting fluorescence photons to signals using a factor ( \(\eta_{collect}\) ). This factor encompasses various elements like the numerical aperture of the objective lens, the transmission of the detection optics, and the conversion efficiency of the detectors. The signal is usually measured by the number of photons recorded, which we&rsquo;ll call &ldquo;signal photons&rdquo; here. So, the total count of signal photons ( \(N_{Signal}\) ) generated by one laser pulse can be expressed as:</p><p>$$
N_{Signal} = \eta_{collect} \cdot N_{totFP}
$$</p><p>$$
\backsimeq \eta_{collect} \cdot \rho_{fluor} \cdot \eta_{Q} \cdot \sigma_{2PCross} \cdot P_{avg}^2 ( \frac{1}{f_{PulseRR}} )^2 ( \frac{1}{\tau_{PW}} ) ( \frac{1}{A_{focus}} ) \cdot d_{focus}
$$</p><h3 id=integration-of-multiple-pulses-and-signal-to-noise-ratio>Integration of Multiple Pulses and Signal-to-Noise Ratio<a hidden class=anchor aria-hidden=true href=#integration-of-multiple-pulses-and-signal-to-noise-ratio>#</a></h3><p>Typically, in two-photon microscopes, the microscope stays at each pixel spot (or, scan location) for a specific amount of time (which is usually called dwell time). During this time, multiple laser pulses hit the sample, and all the fluorescence generated by these pulses are collected. So, the overall signal for each pixel spot (or, scan location) can be calculated like this:</p><p>$$
N_{totSignal} = N_{pulse} \cdot N_{Signal}
$$
$$
\backsimeq N_{pulse} \cdot \eta_{collect} \cdot \rho_{fluor} \cdot \eta_{Q} \cdot \sigma_{2PCross} \cdot P_{avg}^2 ( \frac{1}{f_{PulseRR}} )^2 ( \frac{1}{\tau_{PW}} ) ( \frac{1}{A_{focus}} ) \cdot d_{focus}
$$</p><p>Where \(N_{Pulse}\) is the number of laser pulses that hit the sample at each scan location.</p><p>The distribution of signal photons usually follows a Poisson distribution. If we suppose that all other sources of noise in the system, like electrical noise, ambient light leaking in, or fluctuations in the laser pulse energy, are negligible, the signal to noise ratio (SNR) of each scan location can be written as:</p><p>$$
SNR = \sqrt{N_{totSignal}}
$$</p><h3 id=side-notes>Side Notes<a hidden class=anchor aria-hidden=true href=#side-notes>#</a></h3><p>Usually, the specific characteristics of the fluorophores ( \(\rho_{fluor}\) , \(\eta_{Q}\) , and \(\sigma_{2PCross}\) ) are difficult to be quantified. However, we can compare the signals from two fluorophores under the same conditions. By doing this, we can determine how much brighter one fluorophore is compared to another. Taking in the formula we derived above, for fluorophores A and B, if we image them with the same two photon microscope and exactly the same condition, we can have the following comparison result:</p><p>$$
\frac{ \rho_{fluor_A} \cdot \eta_{Q_A} \cdot \sigma_{2PCross_A} }{ \rho_{fluor_B} \cdot \eta_{Q_B} \cdot \sigma_{2PCross_B} } = \frac{N_{totSignal_A}}{N_{totSignal_B}}
$$</p><h2 id=example-application>Example Application<a hidden class=anchor aria-hidden=true href=#example-application>#</a></h2><p>As a practice, let’s explore how to double the signal-to-noise ratio (SNR) of a two photon microscope.</p><p>To improve the signal-to-noise ratio (SNR) of a two-photon imaging system by two times, we need to boost the signal by four times, according to the formula mentioned earlier. Here are some potential strategies we can consider:</p><ul><li><p>Increase dwell time at each pixel by four times. This means letting the microscope linger longer at each pixel to gather more signal from the incident pulses. However, this might slow down the overall imaging process or reduce the number of pixels in the image, which could affect certain applications.</p></li><li><p>Compress the pulse duration by four times. Adding a module for pulse compression or dispersion compensation optics in the system can achieve this. It helps in packing more energy into each pulse, potentially enhancing the signal.</p></li><li><p>Double the average power. While increasing power can boost signal strength, it must be done cautiously to avoid damaging the sample.</p></li><li><p>Enhance detection efficiency by four times. This involves optimizing both the optical and electronic designs of the detection system to capture more of the fluorescence signal.</p></li></ul><p>These methods aren&rsquo;t mutually exclusive; we can combine several approaches to achieve the desired increase in SNR. However, it&rsquo;s crucial to carefully evaluate the impact of each strategy on the overall system performance and the specific requirements of the application at hand.</p><h2 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h2><p>Understanding the imaging system in numbers is key for its design and optimization. The simplest math models and assumptions are a good start for our analysis, and usually reveal a lot about the system. Also, keep in mind the assumptions and simplifications we made during modeling. This way, we can easily come back to validate and refine your model later if needed.</p><h2 id=citation>Citation<a hidden class=anchor aria-hidden=true href=#citation>#</a></h2><p>If you found this article helpful, please cite it as:</p><blockquote><p>Zhong, Jian (Apr 2024). Basic Math for Two Photon Fluorescence Microscopy. Vision Tech Insights. <a href=https://jianzhongdev.github.io/VisionTechInsights/posts/basic_math_for_two_photon_fluorescence_microscopy/>https://jianzhongdev.github.io/VisionTechInsights/posts/basic_math_for_two_photon_fluorescence_microscopy/</a>.</p></blockquote><p>Or</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-html data-lang=html><span class=line><span class=cl>@article{zhong2024basicmath2PFM,
</span></span><span class=line><span class=cl>  title   = &#34;Basic Math for Two Photon Fluorescence Microscopy&#34;,
</span></span><span class=line><span class=cl>  author  = &#34;Zhong, Jian&#34;,
</span></span><span class=line><span class=cl>  journal = &#34;jianzhongdev.github.io&#34;,
</span></span><span class=line><span class=cl>  year    = &#34;2024&#34;,
</span></span><span class=line><span class=cl>  month   = &#34;Apr&#34;,
</span></span><span class=line><span class=cl>  url     = &#34;https://jianzhongdev.github.io/VisionTechInsights/posts/basic_math_for_two_photon_fluorescence_microscopy/&#34;
</span></span><span class=line><span class=cl>}
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=http://localhost:1313/tags/modeling/>Modeling</a></li><li><a href=http://localhost:1313/tags/imaging-system/>Imaging System</a></li><li><a href=http://localhost:1313/tags/optics/>Optics</a></li></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/building_a_configuration_file_parser_with_cpp/><span class=title>« Prev</span><br><span>Building a Configuration File Parser with C++</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Basic Math for Two Photon Fluorescence Microscopy on x" href="https://x.com/intent/tweet/?text=Basic%20Math%20for%20Two%20Photon%20Fluorescence%20Microscopy&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fbasic_math_for_two_photon_fluorescence_microscopy%2f&amp;hashtags=modeling%2cimagingsystem%2coptics"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Basic Math for Two Photon Fluorescence Microscopy on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fbasic_math_for_two_photon_fluorescence_microscopy%2f&amp;title=Basic%20Math%20for%20Two%20Photon%20Fluorescence%20Microscopy&amp;summary=Basic%20Math%20for%20Two%20Photon%20Fluorescence%20Microscopy&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fbasic_math_for_two_photon_fluorescence_microscopy%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Basic Math for Two Photon Fluorescence Microscopy on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fbasic_math_for_two_photon_fluorescence_microscopy%2f&title=Basic%20Math%20for%20Two%20Photon%20Fluorescence%20Microscopy"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Basic Math for Two Photon Fluorescence Microscopy on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fbasic_math_for_two_photon_fluorescence_microscopy%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Basic Math for Two Photon Fluorescence Microscopy on whatsapp" href="https://api.whatsapp.com/send?text=Basic%20Math%20for%20Two%20Photon%20Fluorescence%20Microscopy%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fbasic_math_for_two_photon_fluorescence_microscopy%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Basic Math for Two Photon Fluorescence Microscopy on telegram" href="https://telegram.me/share/url?text=Basic%20Math%20for%20Two%20Photon%20Fluorescence%20Microscopy&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fbasic_math_for_two_photon_fluorescence_microscopy%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Basic Math for Two Photon Fluorescence Microscopy on ycombinator" href="https://news.ycombinator.com/submitlink?t=Basic%20Math%20for%20Two%20Photon%20Fluorescence%20Microscopy&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fbasic_math_for_two_photon_fluorescence_microscopy%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>Vision Tech Insights</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>